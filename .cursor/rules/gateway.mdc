---

## 1. Äá»‹nh tuyáº¿n yÃªu cáº§u (Request Routing)
- **MÃ´ táº£**: Chuyá»ƒn hÆ°á»›ng request tá»« client Ä‘áº¿n Ä‘Ãºng microservice dá»±a trÃªn path, HTTP method hoáº·c tiÃªu chÃ­ khÃ¡c.
- **VÃ­ dá»¥**: Proxy `/api/v1/users` â†’ `users-service`, `/api/v1/orders` â†’ `orders-service`.
- **Triá»ƒn khai**: Sá»­ dá»¥ng `http-proxy-middleware` vá»›i `proxyConfig` Ä‘á»ƒ Ä‘á»‹nh nghÄ©a route Ä‘á»™ng.
- **Tráº¡ng thÃ¡i**: ÄÃ£ triá»ƒn khai (`/api/v1/users`, `/api/v1/auth`).
- **Best Practice**:
  - DÃ¹ng biáº¿n mÃ´i trÆ°á»ng cho service URLs
  - Path rewriting Ä‘á»ƒ áº©n internal structure
  - WebSocket support cho realtime features

---

## 2. XÃ¡c thá»±c & PhÃ¢n quyá»n (Authentication & Authorization)
- **MÃ´ táº£**: Kiá»ƒm tra danh tÃ­nh vÃ  quyá»n truy cáº­p trÆ°á»›c khi chuyá»ƒn tiáº¿p request.
- **VÃ­ dá»¥**: XÃ¡c minh JWT, OAuth token, API key; kiá»ƒm tra vai trÃ² (admin, user...).
- **Triá»ƒn khai**: Middleware xÃ¡c minh JWT báº±ng `jsonwebtoken`. Bá» qua má»™t sá»‘ route public (`/api/v1/auth`, `/api/v1/docs`).
- **Tráº¡ng thÃ¡i**: Má»›i tÃ­ch há»£p Swagger (`addBearerAuth`), chÆ°a cÃ³ middleware chuyÃªn biá»‡t.
- **Best Practice**:
  - JWT validation á»Ÿ gateway level
  - Public routes whitelist
  - Role-based access control (RBAC)
  - Token refresh handling

---

## 3. Giá»›i háº¡n táº§n suáº¥t (Rate Limiting)
- **MÃ´ táº£**: Giá»›i háº¡n sá»‘ lÆ°á»£ng request tá»« má»™t client Ä‘á»ƒ trÃ¡nh quÃ¡ táº£i/DDoS.
- **VÃ­ dá»¥**: Tá»‘i Ä‘a 100 request má»—i IP trong 15 phÃºt.
- **Triá»ƒn khai**: DÃ¹ng `@nestjs/throttler` hoáº·c `express-rate-limit`.
- **Tráº¡ng thÃ¡i**: ChÆ°a triá»ƒn khai. Khuyáº¿n nghá»‹ bá»• sung.
- **Best Practice**:
  - IP-based rate limiting
  - User-based rate limiting (náº¿u cÃ³ auth)
  - Different limits cho different endpoints
  - Rate limit headers trong response

---

## 4. Kiá»ƒm tra dá»¯ liá»‡u Ä‘áº§u vÃ o (Input Validation)
- **MÃ´ táº£**: XÃ¡c minh vÃ  lÃ m sáº¡ch dá»¯ liá»‡u request (body, query, params).
- **VÃ­ dá»¥**: Kiá»ƒm tra email há»£p lá»‡, trÆ°á»ng báº¯t buá»™c vá»›i `class-validator`.
- **Triá»ƒn khai**: DÃ¹ng `ValidationPipe` + `validationOptions`.
- **Tráº¡ng thÃ¡i**: ÄÃ£ triá»ƒn khai, cÃ³ pháº£n há»“i lá»—i chi tiáº¿t.
- **Best Practice**:
  - Whitelist validation
  - Transform data types
  - Custom validation decorators
  - Detailed error messages

---

## 5. CÃ¢n báº±ng táº£i (Load Balancing)
- **MÃ´ táº£**: PhÃ¢n phá»‘i request Ä‘áº¿n nhiá»u instance Ä‘á»ƒ Ä‘áº£m báº£o kháº£ nÄƒng má»Ÿ rá»™ng vÃ  sáºµn sÃ ng.
- **VÃ­ dá»¥**: `users-service` cÃ³ nhiá»u instance.
- **Triá»ƒn khai**: TÃ­ch há»£p load balancer (Nginx) hoáº·c `http-proxy-middleware` nhiá»u target.
- **Tráº¡ng thÃ¡i**: ChÆ°a triá»ƒn khai. Gá»£i Ã½ dÃ¹ng Kubernetes hoáº·c service registry.
- **Best Practice**:
  - Round-robin hoáº·c least-connections
  - Health check cho backend instances
  - Failover mechanism
  - Session affinity náº¿u cáº§n

---

## 6. Bá»™ nhá»› Ä‘á»‡m (Caching)
- **MÃ´ táº£**: Cache pháº£n há»“i Ä‘á»ƒ giáº£m Ä‘á»™ trá»… vÃ  táº£i há»‡ thá»‘ng.
- **VÃ­ dá»¥**: Cache danh sÃ¡ch sáº£n pháº©m tá»« `products-service` báº±ng Redis.
- **Triá»ƒn khai**: `cache-manager` hoáº·c Redis.
- **Tráº¡ng thÃ¡i**: ChÆ°a triá»ƒn khai. Khuyáº¿n nghá»‹ bá»• sung cho dá»¯ liá»‡u truy cáº­p thÆ°á»ng xuyÃªn.
- **Best Practice**:
  - Cache GET requests only
  - Cache invalidation strategy
  - TTL configuration
  - Cache headers (ETag, Last-Modified)

---

## 7. Ghi log & GiÃ¡m sÃ¡t (Logging & Monitoring)
- **MÃ´ táº£**: Ghi nháº­n request/response/lá»—i Ä‘á»ƒ debug vÃ  theo dÃµi hiá»‡u nÄƒng.
- **VÃ­ dá»¥**: DÃ¹ng `morgan` Ä‘á»ƒ log, Prometheus/Grafana Ä‘á»ƒ giÃ¡m sÃ¡t.
- **Triá»ƒn khai**: ÄÃ£ cÃ³ `morgan`.
- **Tráº¡ng thÃ¡i**: ChÆ°a tÃ­ch há»£p Prometheus/Grafana.
- **Best Practice**:
  - Structured logging (JSON format)
  - Request ID tracking
  - Performance metrics
  - Error aggregation
  - Alerting rules

---

## 8. Xá»­ lÃ½ lá»—i (Error Handling)
- **MÃ´ táº£**: Chuáº©n hÃ³a vÃ  xá»­ lÃ½ lá»—i tá»« microservice, tráº£ vá» pháº£n há»“i Ä‘á»“ng nháº¥t.
- **VÃ­ dá»¥**: Lá»—i 500 tá»« service â†’ Gateway tráº£ vá» 502 kÃ¨m thÃ´ng bÃ¡o rÃµ rÃ ng.
- **Triá»ƒn khai**: `onError` trong `http-proxy-middleware`, global error handler.
- **Tráº¡ng thÃ¡i**: Má»›i xá»­ lÃ½ lá»—i validation. ChÆ°a cÃ³ xá»­ lÃ½ lá»—i proxy tá»•ng thá»ƒ.
- **Best Practice**:
  - Standardized error format
  - Error codes mapping
  - Retry mechanism
  - Circuit breaker integration
  - User-friendly error messages

---

## 9. TÃ i liá»‡u API (API Documentation)
- **MÃ´ táº£**: Cung cáº¥p tÃ i liá»‡u API cho developer.
- **VÃ­ dá»¥**: Swagger UI táº¡i `/api/v1/docs`.
- **Triá»ƒn khai**: `@nestjs/swagger`.
- **Tráº¡ng thÃ¡i**: ÄÃ£ triá»ƒn khai, cÃ³ `BearerAuth` vÃ  custom header (`x-custom-lang`).
- **Best Practice**:
  - OpenAPI 3.0 specification
  - Authentication documentation
  - Example requests/responses
  - Interactive testing
  - Version-specific docs

---

## 10. Há»— trá»£ WebSocket & Streaming
- **MÃ´ táº£**: Quáº£n lÃ½ WebSocket vÃ  streaming dá»¯ liá»‡u.
- **VÃ­ dá»¥**: Realtime chat táº¡i `/api/v1/messages`.
- **Triá»ƒn khai**: `ws: true` trong `http-proxy-middleware`.
- **Tráº¡ng thÃ¡i**: ÄÃ£ triá»ƒn khai.
- **Best Practice**:
  - WebSocket upgrade handling
  - Connection pooling
  - Message routing
  - Heartbeat mechanism
  - Graceful connection close

---

## 11. Biáº¿n Ä‘á»•i Request/Response
- **MÃ´ táº£**: Chá»‰nh sá»­a dá»¯ liá»‡u request/response Ä‘á»ƒ phÃ¹ há»£p yÃªu cáº§u.
- **VÃ­ dá»¥**: ThÃªm header, thay Ä‘á»•i format JSON.
- **Triá»ƒn khai**: Middleware tÃ¹y chá»‰nh.
- **Tráº¡ng thÃ¡i**: ChÆ°a triá»ƒn khai.
- **Best Practice**:
  - Header transformation
  - Request/response body modification
  - Content-type handling
  - Compression (gzip)
  - Custom middleware chain

---

## 12. PhiÃªn báº£n API (API Versioning)
- **MÃ´ táº£**: Há»— trá»£ nhiá»u phiÃªn báº£n API cho backward compatibility.
- **VÃ­ dá»¥**: `/api/v1/users` vÃ  `/api/v2/users`.
- **Triá»ƒn khai**: `VersioningType.URI` vá»›i version máº·c Ä‘á»‹nh `v1`.
- **Tráº¡ng thÃ¡i**: ÄÃ£ triá»ƒn khai.
- **Best Practice**:
  - URI versioning (recommended)
  - Header versioning (alternative)
  - Default version handling
  - Deprecation warnings
  - Migration strategy

---

## 13. Kiá»ƒm tra tÃ¬nh tráº¡ng (Health Check)
- **MÃ´ táº£**: Cung cáº¥p endpoint kiá»ƒm tra tÃ¬nh tráº¡ng Gateway vÃ  microservice.
- **VÃ­ dá»¥**: `/api/v1/health`.
- **Triá»ƒn khai**: Endpoint GET.
- **Tráº¡ng thÃ¡i**: ÄÃ£ triá»ƒn khai.
- **Best Practice**:
  - Liveness probe
  - Readiness probe
  - Dependency health checks
  - Detailed health status
  - Health check aggregation

---

## 14. Circuit Breaker
- **MÃ´ táº£**: Táº¡m ngá»«ng gá»­i request Ä‘áº¿n service bá»‹ lá»—i liÃªn tá»¥c Ä‘á»ƒ trÃ¡nh lan truyá»n sá»± cá»‘.
- **VÃ­ dá»¥**: Dá»«ng proxy Ä‘áº¿n `users-service` khi gáº·p nhiá»u lá»—i 500.
- **Triá»ƒn khai**: ThÆ° viá»‡n `opossum`.
- **Tráº¡ng thÃ¡i**: ChÆ°a triá»ƒn khai.
- **Best Practice**:
  - Failure threshold configuration
  - Recovery timeout
  - Half-open state
  - Fallback responses
  - Circuit breaker metrics

---

## 15. Service Discovery
- **MÃ´ táº£**: Tá»± Ä‘á»™ng tÃ¬m microservice instance qua service registry.
- **VÃ­ dá»¥**: Consul, Eureka, hoáº·c Kubernetes Service.
- **Triá»ƒn khai**: Káº¿t ná»‘i registry hoáº·c Kubernetes.
- **Tráº¡ng thÃ¡i**: ChÆ°a triá»ƒn khai (hiá»‡n dÃ¹ng biáº¿n mÃ´i trÆ°á»ng).
- **Best Practice**:
  - Service registry integration
  - Dynamic service discovery
  - Health check integration
  - Load balancing integration
  - Service mesh compatibility

---

## 16. CÃ¡c váº¥n Ä‘á» cáº¯t ngang (Cross-Cutting Concerns)
- **MÃ´ táº£**: Xá»­ lÃ½ cÃ¡c tÃ¡c vá»¥ chung (nÃ©n dá»¯ liá»‡u, thÃªm header...).
- **VÃ­ dá»¥**: NÃ©n báº±ng Gzip, thÃªm `x-custom-lang`.
- **Triá»ƒn khai**: Middleware `compression`, custom header.
- **Tráº¡ng thÃ¡i**: Má»›i cÃ³ header, chÆ°a cÃ³ nÃ©n.
- **Best Practice**:
  - Compression middleware
  - Custom headers injection
  - Request/response transformation
  - Cross-origin handling
  - Security headers

---

## 17. Quáº£n lÃ½ cáº¥u hÃ¬nh (Configuration Management)
- **MÃ´ táº£**: Quáº£n lÃ½ URL, secrets, setting cá»§a microservice.
- **VÃ­ dá»¥**: `USERS_SERVICE_URL` tá»« `.env` hoáº·c Vault.
- **Triá»ƒn khai**: Biáº¿n mÃ´i trÆ°á»ng (`process.env`).
- **Tráº¡ng thÃ¡i**: ÄÃ£ triá»ƒn khai.
- **Best Practice**:
  - Environment-based configuration
  - Secret management (Vault, AWS Secrets Manager)
  - Configuration validation
  - Hot reload capability
  - Configuration versioning

## Triá»ƒn Khai Khuyáº¿n Nghá»‹

### Phase 1 (Hiá»‡n táº¡i - Slim Gateway)
- âœ… Request Routing
- âœ… Basic Security (CORS, Helmet)
- âœ… Logging (Morgan)
- âœ… Health Check
- âœ… Configuration Management

### Phase 2 (Sáº¯p tá»›i)
- ğŸ”„ Authentication & Authorization
- ğŸ”„ Rate Limiting
- ğŸ”„ Error Handling
- ğŸ”„ API Documentation (Swagger)

### Phase 3 (TÆ°Æ¡ng lai)
- ğŸ“‹ Load Balancing
- ğŸ“‹ Caching
- ğŸ“‹ Circuit Breaker
- ğŸ“‹ Service Discovery
- ğŸ“‹ Advanced Monitoring

